{
  "metadata": {
    "project_name": "CookieCloud",
    "description": "CookieCloud 服务端接口 Go 语言实现版本（小型项目）",
    "language": "Go",
    "version": "1.0.0",
    "last_scan": "2026-01-12T09:24:23+08:00",
    "scanner_version": "1.0.0",
    "last_commit": "6c73048"
  },
  "scan_statistics": {
    "total_files_estimated": 20,
    "source_files": 9,
    "test_files": 4,
    "scanned_files": 9,
    "coverage_percent": 100,
    "ignored_files": 11,
    "test_coverage": 72.6,
    "test_count": 63,
    "truncated": false,
    "project_type": "小型项目（不需要集成测试）"
  },
  "modules": [
    {
      "name": "cmd/cookiecloud",
      "path": "cmd/cookiecloud",
      "type": "entry",
      "language": "Go",
      "description": "应用启动、依赖注入组装、路由注册和优雅关闭",
      "entry_point": "cmd/cookiecloud/main.go",
      "test_file": "",
      "has_tests": false,
      "test_coverage": 0,
      "has_config": false,
      "coverage": 100,
      "note": "小型项目不需要集成测试，核心逻辑已通过其他模块测试覆盖",
      "interfaces": [
        {
          "type": "http",
          "description": "HTTP 服务器启动",
          "port": "8088",
          "endpoints": [
            "GET/POST /",
            "POST /update",
            "GET/POST /get/:uuid"
          ]
        }
      ],
      "dependencies": [
        "internal/config",
        "internal/handlers",
        "internal/storage",
        "github.com/gofiber/fiber/v2",
        "github.com/gofiber/fiber/v2/middleware/cors"
      ],
      "environment_variables": [
        {
          "name": "PORT",
          "default": "8088",
          "description": "HTTP 服务监听端口"
        },
        {
          "name": "API_ROOT",
          "default": "",
          "description": "API 根路径"
        }
      ],
      "key_features": [
        "依赖注入组装",
        "优雅关闭（30秒超时）",
        "信号处理（SIGINT, SIGTERM）"
      ],
      "gaps": [],
      "docs": "./cmd/cookiecloud/CLAUDE.md"
    },
    {
      "name": "internal/config",
      "path": "internal/config",
      "type": "config",
      "language": "Go",
      "description": "配置加载和管理（环境变量）",
      "entry_point": "internal/config/config.go",
      "test_file": "internal/config/config_test.go",
      "has_tests": true,
      "test_coverage": 100,
      "test_cases": 6,
      "has_config": false,
      "coverage": 100,
      "interfaces": [
        {
          "type": "struct",
          "name": "Config",
          "fields": [
            {"name": "Port", "type": "string", "description": "HTTP 监听端口"},
            {"name": "APIRoot", "type": "string", "description": "API 路径前缀"},
            {"name": "DataDir", "type": "string", "description": "数据存储目录"}
          ]
        },
        {
          "type": "function",
          "name": "Load",
          "signature": "func Load() *Config",
          "description": "加载配置（环境变量 + 默认值）"
        }
      ],
      "dependencies": [],
      "environment_variables": [
        {
          "name": "PORT",
          "default": "8088",
          "description": "HTTP 监听端口"
        },
        {
          "name": "API_ROOT",
          "default": "",
          "description": "API 路径前缀（自动去除尾部斜杠）"
        },
        {
          "name": "DATA_DIR",
          "default": "./data",
          "description": "数据存储目录"
        }
      ],
      "test_highlights": [
        "默认配置加载测试",
        "环境变量覆盖测试",
        "API_ROOT 尾部斜杠处理测试",
        "部分环境变量设置测试",
        "辅助函数测试",
        "配置结构体验证测试"
      ],
      "gaps": [],
      "docs": "./internal/config/CLAUDE.md"
    },
    {
      "name": "internal/handlers",
      "path": "internal/handlers",
      "type": "handler",
      "language": "Go",
      "description": "HTTP 请求处理与响应",
      "entry_point": "internal/handlers/handlers.go",
      "test_file": "internal/handlers/handlers_test.go",
      "has_tests": true,
      "test_coverage": 87.9,
      "test_cases": 23,
      "has_config": false,
      "coverage": 100,
      "interfaces": [
        {
          "type": "function",
          "name": "FiberRootHandler",
          "signature": "func FiberRootHandler(apiRoot string) fiber.Handler",
          "description": "根路径处理器，返回欢迎信息"
        },
        {
          "type": "function",
          "name": "FiberUpdateHandler",
          "signature": "func (h *Handlers) FiberUpdateHandler(c *fiber.Ctx) error",
          "description": "处理更新请求，保存加密数据"
        },
        {
          "type": "function",
          "name": "FiberGetHandler",
          "signature": "func (h *Handlers) FiberGetHandler(c *fiber.Ctx) error",
          "description": "处理获取数据请求，支持解密"
        }
      ],
      "dependencies": [
        "internal/crypto",
        "internal/storage",
        "github.com/gofiber/fiber/v2"
      ],
      "data_models": [
        {
          "name": "Handlers",
          "fields": [
            {"name": "store", "type": "*storage.Storage", "description": "存储实例（依赖注入）"}
          ]
        },
        {
          "name": "UpdateRequest",
          "fields": [
            {"name": "UUID", "type": "string", "json": "uuid"},
            {"name": "Encrypted", "type": "string", "json": "encrypted"}
          ]
        },
        {
          "name": "DecryptRequest",
          "fields": [
            {"name": "Password", "type": "string", "json": "password"}
          ]
        }
      ],
      "test_highlights": [
        "构造函数测试",
        "根路径处理器测试（GET/POST）",
        "更新处理器成功测试",
        "参数缺失验证测试",
        "无效 JSON 测试",
        "获取数据成功测试",
        "数据不存在测试",
        "解密请求测试",
        "错误响应格式测试",
        "完整流程测试",
        "并发请求测试（50个并发）",
        "超长数据测试",
        "重复请求测试",
        "性能基准测试"
      ],
      "gaps": [],
      "docs": "./internal/handlers/CLAUDE.md"
    },
    {
      "name": "internal/storage",
      "path": "internal/storage",
      "type": "storage",
      "language": "Go",
      "description": "数据持久化与文件操作（并发安全）",
      "entry_point": "internal/storage/storage.go",
      "test_file": "internal/storage/storage_test.go",
      "has_tests": true,
      "test_coverage": 91.7,
      "test_cases": 20,
      "has_config": false,
      "coverage": 100,
      "interfaces": [
        {
          "type": "function",
          "name": "New",
          "signature": "func New(dataDir string) (*Storage, error)",
          "description": "创建存储实例（依赖注入配置）"
        },
        {
          "type": "function",
          "name": "SaveEncryptedData",
          "signature": "func (s *Storage) SaveEncryptedData(uuid, encrypted string) error",
          "description": "保存加密数据到文件（并发安全）"
        },
        {
          "type": "function",
          "name": "LoadEncryptedData",
          "signature": "func (s *Storage) LoadEncryptedData(uuid string) (*CookieData, error)",
          "description": "从文件加载加密数据"
        }
      ],
      "dependencies": [
        "encoding/json",
        "os",
        "path/filepath",
        "sync"
      ],
      "data_models": [
        {
          "name": "Storage",
          "fields": [
            {"name": "dataDir", "type": "string", "description": "数据目录路径"},
            {"name": "fileLocks", "type": "sync.Map", "description": "文件锁映射"}
          ]
        },
        {
          "name": "CookieData",
          "fields": [
            {"name": "Encrypted", "type": "string", "json": "encrypted"}
          ]
        }
      ],
      "storage_type": "JSON Files",
      "storage_path": "./data",
      "key_features": [
        "并发安全（sync.Map 文件锁）",
        "依赖注入设计",
        "零全局变量"
      ],
      "test_highlights": [
        "构造函数测试",
        "保存和加载测试",
        "数据不存在测试",
        "数据覆盖测试",
        "并发写入测试（100个并发）",
        "多 UUID 独立存储测试",
        "JSON 格式验证测试",
        "特殊字符处理测试",
        "文件锁机制测试",
        "空数据和长数据测试",
        "无效 JSON 处理测试",
        "多次读取测试",
        "不同大小数据覆盖测试",
        "性能基准测试"
      ],
      "gaps": [],
      "docs": "./internal/storage/CLAUDE.md"
    },
    {
      "name": "internal/crypto",
      "path": "internal/crypto",
      "type": "crypto",
      "language": "Go",
      "description": "加密解密算法实现（兼容 CryptoJS）",
      "entry_point": "internal/crypto/crypto.go",
      "test_file": "internal/crypto/crypto_test.go",
      "has_tests": true,
      "test_coverage": 93.5,
      "test_cases": 16,
      "has_config": false,
      "coverage": 100,
      "interfaces": [
        {
          "type": "function",
          "name": "Decrypt",
          "signature": "func Decrypt(uuid, encrypted, password string) []byte",
          "description": "解密 Cookie 数据（兼容 CryptoJS）"
        }
      ],
      "dependencies": [
        "crypto/aes",
        "crypto/cipher",
        "crypto/md5",
        "encoding/base64",
        "encoding/hex"
      ],
      "algorithms": [
        "AES-256-CBC",
        "EVP_BytesToKey (OpenSSL)",
        "PKCS7 Padding",
        "MD5 Hash"
      ],
      "key_features": [
        "CryptoJS 兼容",
        "OpenSSL EVP_BytesToKey 实现",
        "自动处理盐值和 IV"
      ],
      "test_highlights": [
        "MD5 哈希计算测试",
        "多字符串拼接 MD5 测试",
        "PKCS7 填充移除测试",
        "密钥派生函数测试",
        "无效盐值测试",
        "无效密文格式测试",
        "解密函数测试",
        "密钥生成逻辑测试",
        "常量定义测试",
        "边界条件测试",
        "成功解密测试",
        "PKCS7 边缘情况测试",
        "性能基准测试"
      ],
      "gaps": [],
      "docs": "./internal/crypto/CLAUDE.md"
    }
  ],
  "dependencies": {
    "go": {
      "version": "1.25.5",
      "modules": [
        {
          "path": "github.com/gofiber/fiber/v2",
          "version": "v2.52.10"
        }
      ],
      "indirect": [
        "github.com/andybalholm/brotli",
        "github.com/google/uuid",
        "github.com/klauspost/compress",
        "github.com/mattn/go-colorable",
        "github.com/mattn/go-isatty",
        "github.com/mattn/go-runewidth",
        "github.com/rivo/uniseg",
        "github.com/valyala/bytebufferpool",
        "github.com/valyala/fasthttp",
        "github.com/valyala/tcplisten",
        "golang.org/x/sys"
      ]
    }
  },
  "architecture": {
    "pattern": "依赖注入 + 分层架构",
    "layers": [
      "cmd - 应用入口和依赖组装",
      "handlers - HTTP 请求处理层",
      "storage - 数据持久化层",
      "crypto - 加密服务层",
      "config - 配置管理层"
    ],
    "key_features": [
      "零全局变量",
      "依赖注入（通过构造函数）",
      "并发安全（sync.Map 文件锁）",
      "优雅关闭（信号处理）",
      "客户端加密（零知识架构）",
      "高测试覆盖率（72.6%）",
      "代码质量检查（golangci-lint）"
    ],
    "dependency_tree": "main → config → storage → handlers → crypto",
    "test_coverage": {
      "config": 100.0,
      "crypto": 93.5,
      "storage": 91.7,
      "handlers": 87.9,
      "overall": 72.6
    },
    "quality_tools": {
      "golangci_lint": {
        "config_file": ".golangci.yml",
        "enabled_linters": [
          "gofmt",
          "goimports",
          "govet",
          "staticcheck",
          "ineffassign",
          "misspell",
          "revive",
          "gocyclo",
          "funlen",
          "errcheck",
          "prealloc",
          "unconvert",
          "unused"
        ],
        "note": "所有检查器已配置，代码通过格式化和质量检查"
      },
      "package_comments": {
        "status": "完成",
        "note": "所有包都有 package 注释"
      }
    }
  },
  "configuration_files": [
    {
      "path": "Dockerfile",
      "type": "docker",
      "description": "多阶段 Docker 构建配置（golang:alpine → scratch）"
    },
    {
      "path": ".golangci.yml",
      "type": "code_quality",
      "description": "golangci-lint 配置文件（13个检查器）"
    },
    {
      "path": ".github/workflows/docker-image.yml",
      "type": "github_actions",
      "description": "CI/CD Docker 镜像构建流程"
    },
    {
      "path": ".gitignore",
      "type": "git",
      "description": "Git 忽略规则（data、coverage 文件、golangci-lint 缓存）"
    }
  ],
  "ignore_rules": [
    "data/**",
    ".git/**",
    ".github/**",
    "dist/**",
    "build/**",
    ".next/**",
    "__pycache__/**",
    "*.lock",
    "*.log",
    "*.bin",
    "*.pdf",
    "*.png",
    "*.jpg",
    "*.jpeg",
    "*.gif",
    "*.mp4",
    "*.zip",
    "*.tar",
    "*.gz",
    "coverage*.out",
    "coverage*.html",
    "*.test",
    ".golangci/**",
    ".golangci.cache",
    "*.sarif",
    "*.prof"
  ],
  "ignored_paths": [
    ".git/",
    "data/"
  ],
  "documentation": {
    "root": "CLAUDE.md",
    "modules": [
      "cmd/cookiecloud/CLAUDE.md",
      "internal/config/CLAUDE.md",
      "internal/handlers/CLAUDE.md",
      "internal/storage/CLAUDE.md",
      "internal/crypto/CLAUDE.md"
    ],
    "readme": [
      "README.md",
      "README_cn.md"
    ]
  },
  "gaps_summary": {
    "critical": [],
    "high": [],
    "medium": [
      "缺少配置文件示例（.env.example）",
      "缺少 Makefile"
    ],
    "low": [
      "缺少 API 文档（OpenAPI/Swagger）",
      "缺少 CI/CD 测试流程"
    ]
  },
  "recommendations": {
    "immediate": [],
    "short_term": [
      "创建 .env.example 配置示例",
      "添加 Makefile 简化开发流程"
    ],
    "long_term": [
      "添加 API 文档（OpenAPI 规范）",
      "添加 CI/CD 测试流程"
    ]
  },
  "next_steps": [
    {
      "priority": "medium",
      "action": "添加配置文件",
      "target": "项目根目录",
      "description": "创建 .env.example 配置示例文件"
    },
    {
      "priority": "medium",
      "action": "添加构建工具",
      "target": "项目根目录",
      "description": "创建 Makefile 包含 build、test、run、clean 等命令"
    }
  ],
  "test_summary": {
    "total_tests": 63,
    "overall_coverage": 72.6,
    "by_module": {
      "config": {
        "tests": 6,
        "coverage": 100.0,
        "file": "config_test.go"
      },
      "crypto": {
        "tests": 16,
        "coverage": 93.5,
        "file": "crypto_test.go"
      },
      "storage": {
        "tests": 20,
        "coverage": 91.7,
        "file": "storage_test.go"
      },
      "handlers": {
        "tests": 23,
        "coverage": 87.9,
        "file": "handlers_test.go"
      },
      "cmd/cookiecloud": {
        "tests": 0,
        "coverage": 0,
        "file": "",
        "note": "小型项目不需要集成测试"
      }
    },
    "test_types": [
      "单元测试",
      "并发测试",
      "边界条件测试",
      "错误处理测试",
      "性能基准测试"
    ],
    "benchmark_tests": [
      "BenchmarkMd5String",
      "BenchmarkDecrypt",
      "BenchmarkSaveAndLoad",
      "BenchmarkConcurrentWrites",
      "BenchmarkUpdateHandler",
      "BenchmarkGetHandler"
    ],
    "project_note": "小型项目，单元测试已足够，不需要集成测试"
  },
  "api_endpoints": [
    {
      "method": "GET/POST",
      "path": "/",
      "description": "健康检查和欢迎信息"
    },
    {
      "method": "POST",
      "path": "/update",
      "description": "保存加密的 Cookie 数据",
      "request_body": {
        "uuid": "string (required)",
        "encrypted": "string (required)"
      }
    },
    {
      "method": "GET",
      "path": "/get/:uuid",
      "description": "获取加密数据",
      "response": {
        "encrypted": "string"
      }
    },
    {
      "method": "POST",
      "path": "/get/:uuid",
      "description": "获取并解密数据",
      "request_body": {
        "password": "string"
      },
      "response": "decrypted JSON data"
    }
  ],
  "quality_metrics": {
    "code_coverage": 72.6,
    "test_count": 63,
    "has_unit_tests": true,
    "has_integration_tests": false,
    "has_benchmarks": true,
    "code_quality_tools": [
      "golangci-lint",
      "gofmt"
    ],
    "package_comments": true,
    "project_size": "小型（<500行核心代码）"
  }
}
